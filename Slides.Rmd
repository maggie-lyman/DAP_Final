---
title: "ADU Presentation"
output: beamer_presentation
date: "2024-02-23"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Chicago Additional Dwelling Units

Maggie Lyman & Max Wagner

---

# What are ADUs?

  - Basement or attic apartment conversions (granny flats)
  - Coach houses
  
In May 2021, Chicago passed the ADU ordinance to streamline zoning requirements for ADU conversion projects in 5 zones: North, Northwest, West, Southwest, South.

The goal of this program is to increase density and provide additional, affordable and naturally affordable apartments. 

---

# Overview of the ADU Ordinance

  - Streamlines the zoning process: City Council approval is not required to build an ADU
  - Removes some parking requirements, increasing affordability of units
  - Properties with 2 or more ADUs must set each additional ADU at 60% area median income (AMI)
  - Additional requirements for ADUs in South, West, and Southwest zones: Buildings with one to three units must be owner-occupied, only two ADU permits issued per block per year, cannot construct coach houses on vacant lots before a principal residence.
  
---

# Our Research Questions

  1. Where are ADUs built in the city? Is there a connection between areas with high rent and areas with more ADUs constructed? 
  2. Where are ADU applications denied?
  3. What kinds of ADUs are built?
  4. What is the public's perception of ADUs?
  
---

# Where are ADUs built?

```{r warning = FALSE, message = FALSE}
## Load packages
library(tidyverse)
library(readr)
library(sf)
library(spData)
library(snakecase)
library(httr)
library(jsonlite)
library(tidycensus)
library(testthat)

## Function
rename_columns <- function(df){ 
  snake <- to_snake_case(names(df))
  names <- noquote(snake, right = FALSE)
  setNames(df, names)
}

make_coord <- function(df){
  st_as_sf(x = df,
           coords = c("longitude", "latitude"),
           crs = 4326)
}

## Load data

# Add path
path <- "C:/Users/mlyma/OneDrive/Documents/GitHub/DAP_Final/"
# path <- "/Users/maxwellwagner/Documents/GitHub/DAP_Final/"

# Read in csv file
adus_issued <- read_csv(paste0(path, "Additional_Dwelling_Unit_Preapprovals_Issued_20240130.csv"))
adu_apps <- read_csv(paste0(path, "Additional_Dwelling_Unit_Preapproval_Applications_20240207.csv"))
# Unzip shape file
zipF <- paste0(path, "Boundaries - Census Tracts - 2010.zip")
unzip(zipF,exdir=path)
# Read in shape file
chicago_tracts <- st_read(
  file.path(path, "geo_export_6356fb24-e715-483f-922e-9fd4badc2b8c.shp")
)
# Change CRS of shapefiles
chicago_tracts <- st_transform(chicago_tracts, 
                              crs = 4326)
# Read in API census data
key <- "a58ec96cdf12838255365193b5aa59b943091de3"
census_data <- get_acs(geography = "tract",
        variables = c("B01003_001", "B05010_001", "B19326_001",
                      "B07002_001", "B07013_002", "B25106_002", "B25064_001",
                      "B25070_001"),
        state = "IL",
        year = 2022,
        output = "tidy",
        county = "Cook",
        key = key,
        survey = "acs5")

## Data Cleaning
# Rename census variables
census_wide <- census_data |>
  dplyr::select(-moe) |>
  pivot_wider(names_from = variable,
              values_from = estimate)

census_clean <- census_wide |>
  rename(total_pop = B01003_001,
         ratio_income_to_poverty = B05010_001,
         median_income = B19326_001,
         median_age = B07002_001,
         owner_occupied_housing = B07013_002,
         owner_occupied_by_perc_income = B25106_002,
         median_gross_rent = B25064_001,
         gross_rent_perc_income = B25070_001)

# Clean column names
adu_clean <- rename_columns(adus_issued)
adu_app_clean <- rename_columns(adu_apps)
census_clean <- rename_columns(census_clean)

# Add coords to ADU
adu_coord <- make_coord(adu_clean)
adu_app_coord <- make_coord(adu_app_clean)

# Join Data
## Static plot - Chloropleth of where ADUs are located
# Merge shape files with ADU coordinates
Chicago_adus_merged <- st_join(chicago_tracts, adu_coord)
Chicago_adu_app_merged <- st_join(chicago_tracts, adu_app_coord)
# Add a new column with a binary variable indicating whether a row represents an ADU permit issued
Chicago_adus_tract <- Chicago_adus_merged |>
  mutate(ADU_tract = if_else(is.na(id), 0, 1))
# Use application dataset to create binary columns for application status
Chicago_adu_app_tract <- Chicago_adu_app_merged |>
  mutate(ADU_tract = ifelse(is.na(id), 0, 1))
Chicago_adu_app_tract <- Chicago_adu_app_tract |>
  mutate(issued = case_when(status == "Issued" &
                              ADU_tract == 1 ~ 1,
                            is.na(status) ~ NA,
                            TRUE ~ 0),
         denied = case_when(status == "Denied" &
                              ADU_tract == 1 ~ 1,
                            is.na(status) ~ NA,
                            TRUE ~ 0),
         pending = case_when(status %in% c("Notification docs requested",
                                           "Affordability docs requested") &
                               ADU_tract == 1 ~ 1,
                             is.na(status) ~ NA,
                             TRUE ~ 0)) 

# Group data by census tract and find total number of ADUs per census tract
Chicago_adus_tract_counts <- Chicago_adus_tract |>
  group_by(tractce10, .drop = FALSE) |>
  summarize(count = sum(ADU_tract))
```

```{r}
# Plot a choropleth of the number of ADUs in each tract
ggplot()  +
  geom_sf(data = Chicago_adus_tract_counts, 
          aes(fill = count)) +
  scale_fill_gradient(low = "white", 
                      high = "dark red") + 
  labs(title = "ADU Permits are Concentrated in North Side Census Tracts", 
       subtitle = "Number of ADU permits issued in Chicago, by census tract",
       fill = "ADU Permits",
       caption = "Source: City of Chicago Data Portal") +
  theme_minimal() 
```

--- 

# Where are ADUs denied?

```{r}
# Group ADUs by tract to identify denial rate, pending rate, and approval rate
# Sum denials per tract
app_aggregated <- Chicago_adu_app_tract |>
  group_by(tractce10) |>
  summarize(issue_rate = mean(issued, na.rm = TRUE),
            denial_rate = mean(denied, na.rm = TRUE),
            pending_rate = mean(pending, na.rm = TRUE),
            total_denials = sum(denied, na.rm = TRUE))
# Filter for points of denial locations
denied_point <- adu_app_coord |>
  filter(status == "Denied")
```

```{r}
# Plot chloropleth with denials
ggplot() +
  geom_sf(data = app_aggregated,
          aes(fill = denial_rate)) +
  geom_sf(data = denied_point,
          size = 2, shape = 21, alpha = 0.5,
          fill = "#238b45",
          color = "black") +
  scale_fill_gradient(low = "#66c2a4",
                      high = "#00441b",
                      na.value = "white") +
  labs(title = "ADU Denials concentrated in North and Southwest Census Tracts", 
       subtitle = "Mean ADU denials and denial locations by census tract",
       fill = "Rate of denials",
       caption = "Source: City of Chicago Data Portal") +
  theme_minimal() 
```

---

# How does ADU construction relate to area income and rent?

 - Shiny App 1 
 
---

# How does the general public feel about the ADU ordinance?

  - Shiny App 2
  
---

# Questions?

---
 
